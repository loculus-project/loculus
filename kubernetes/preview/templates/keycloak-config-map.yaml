{{- $keycloakHost := printf "authentication.%s" .Values.host }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: keycloak-config
  namespace: {{ .Values.namespace }}
data:
  keycloak-config.json: |
    {
      "realm": "pathoplexusRealm",
      "enabled": true,
      "users": [
        {{- $browsers := list "firefox" "webkit" "chromium"}}
        {{- range $_, $browser := $browsers }}
          {{- range $index, $_ := until 20}}
              {
                  "username": "testuser_{{$index}}_{{$browser}}",
                  "enabled": true,
                  "email": "testuser_{{$index}}_{{$browser}}@keycloak.org",
                  "firstName": "Test",
                  "lastName": "User",
                  "credentials": [
                    {
                      "type": "password",
                      "value": "testuser_{{$index}}_{{$browser}}"
                    }
                  ],
                  "realmRoles": [
                    "user",
                    "offline_access"
                  ],
                  "clientRoles": {
                    "account": [
                      "manage-account"
                    ]
                  }
                },      
          {{ end }}
        {{ end }}
        {
            "username": "testuser",
            "enabled": true,
            "email": "testuser@keycloak.org",
            "firstName": "Test",
            "lastName": "User",
            "credentials": [
              {
                "type": "password",
                "value": "testuser"
              }
            ],
            "realmRoles": [
              "user",
              "offline_access"
            ],
            "clientRoles": {
              "account": [
                "manage-account"
              ]
            }
          }
      ],
      "roles": {
        "realm" : [
          {
            "name": "user",
            "description": "User privileges"
          },
          {
            "name": "admin",
            "description": "Administrator privileges"
          }
        ]
      },
      "clients": [
        {
          "clientId": "test-cli",
          "enabled": true,
          "publicClient": true,
          "directAccessGrantsEnabled": true,
          "redirectUris": [
            "*"
          ]
        }
      ],
      "attributes": {
        {{- if eq .Values.environment "server" }}
        "frontendUrl": "https://{{ $keycloakHost}}"
        {{- else }}
        "frontendUrl": "http://localhost:8083"
        {{- end }}
      }
    }

