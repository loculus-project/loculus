{{- $keycloakHost := printf "keycloak.%s" .Values.host }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: pathoplexus-website-config
  namespace: {{ .Values.namespace }}
data:
  website_config.json: |
    {{ .Files.Get "config.yaml" | fromYaml | include "pathoplexus.generateWebsiteConfig" | fromYaml | toJson }}

  runtime_config.json: |
    {
      {{- if eq .Values.mode "dev" }}
      "backendUrl": "http://host.k3d.internal:8079/dummy-organism",
      {{- else }}
      "backendUrl": "http://localhost:8079/dummy-organism",
      {{- end }}
      "lapisUrl": "http://pathoplexus-lapis-service-dummy-organism:8080",
      {{- if eq .Values.mode "dev" }}
      "keycloakUrl": "http://localhost:8083"
      {{- else }}
      "keycloakUrl": "http://pathoplexus-keycloak-service:8083"
      {{- end }}
    }
