{{- $lapisHost := "" }}
{{- if .Values.codespaceName }}
  {{- $lapisHost = printf "https://%s-8080.app.github.dev" .Values.codespaceName }}
{{- else if eq .Values.environment "server" }}
  {{- $lapisHost = printf "https://lapis-%s" .Values.host }}
{{- else }}
  {{- $lapisHost = "http://localhost:8080" }}
{{- end }}
{{- $externalLapisUrlConfig := dict "host" $lapisHost "config" $.Values }}

---
apiVersion: v1
kind: ConfigMap
metadata:
  name: loculus-website-config
data:
  website_config.json: |
    {{ include "loculus.generateWebsiteConfig" . | fromYaml | toJson }}

  runtime_config.json: |
    {
        "name" : "{{ $.Values.name }}",
        "serverSide": {
            "backendUrl": "http://localhost:8079",
            "lapisUrls": {{- include "loculus.generateInternalLapisUrls" . | fromYaml | toJson }},
            "keycloakUrl": "{{ if not .Values.disableWebsite -}}http://loculus-keycloak-service:8083{{ else -}}http://localhost:8083{{ end }}"
        },
        "public": {
            {{- if .Values.codespaceName }}
            "backendUrl": "https://{{ .Values.codespaceName }}-8079.app.github.dev",
            {{- else if eq .Values.environment "server" }}
            "backendUrl": "https://{{ printf "backend-%s" .Values.host }}",
            {{- else }}
            "backendUrl": "http://localhost:8079",
            {{- end }}
            "lapisUrls": {{- include "loculus.generateExternalLapisUrls" $externalLapisUrlConfig | fromYaml | toJson }}
        }
    }
