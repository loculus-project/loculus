---
import { AuthorList } from './AuthorList';
import { DataUseTermsHistoryModal } from './DataUseTermsHistoryModal';
import { SubstitutionsContainer } from './MutationBadge';
import { getDataTableData } from './getDataTableData';
import { type TableDataEntry } from './getTableData';
import { type DataUseTermsHistoryEntry } from '../../types/backend';

interface Props {
    tableData: TableDataEntry[];
    dataUseTermsHistory: DataUseTermsHistoryEntry[];
}

const { tableData, dataUseTermsHistory } = Astro.props;
const data = getDataTableData(tableData);
---

<div>
    {
        data.topmatter.authors !== undefined && data.topmatter.authors.length > 0 && (
            <div class='px-6 mb-4'>
                <AuthorList authors={data.topmatter.authors} client:load />
            </div>
        )
    }
    <div>
        {
            data.table.map(({ header, rows }) => (
                <div class='pb-8'>
                    {header !== '' && <h1 class='py-2 font-medium text-primary-600'>{header}</h1>}
                    <table class='table-auto'>
                        <tbody class='bg-white'>
                            {rows.map(({ label, value, customDisplay }) => (
                                <tr>
                                    <td class='py-1 w-44 text-sm font-medium text-gray-900 text-right'>{label}</td>
                                    <td class='px-4 py-1 text-sm text-gray-600'>
                                        <div class='items-center gap-3 whitespace-wrap'>
                                            {customDisplay === undefined && value}
                                            {customDisplay !== undefined &&
                                                customDisplay.type === 'badge' &&
                                                (customDisplay.value === undefined ? (
                                                    ''
                                                ) : (
                                                    <SubstitutionsContainer values={customDisplay.value} />
                                                ))}
                                            {customDisplay !== undefined &&
                                                customDisplay.type === 'link' &&
                                                customDisplay.url !== undefined && (
                                                    <a
                                                        href={customDisplay.url.replaceAll(
                                                            '{{value}}',
                                                            value.toString(),
                                                        )}
                                                        target='_blank'
                                                        class='underline'
                                                    >
                                                        {value}
                                                    </a>
                                                )}
                                            {customDisplay !== undefined && customDisplay.type === 'dataUseTerms' && (
                                                <>
                                                    {value}{' '}
                                                    <DataUseTermsHistoryModal
                                                        dataUseTermsHistory={dataUseTermsHistory}
                                                        client:only='react'
                                                    />
                                                </>
                                            )}
                                        </div>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            ))
        }
    </div>
</div>
