---
import { getLatestAccessionVersion } from './getTableData';
import { routes } from '../../routes.ts';
import { type SequenceEntryHistory, type SiloVersionStatus, siloVersionStatuses } from '../../types/lapis';
import { getAccessionVersionString } from '../../utils/extractAccessionVersion';

interface Props {
    sequenceEntryHistory: SequenceEntryHistory;
    versionStatus: SiloVersionStatus;
    organism: string;
}

const { sequenceEntryHistory, versionStatus, organism } = Astro.props;

// TODO(#619): Currently there are no revocation entry versions in SILO. When they are introduced, this condition has to be expanded.
//  If versionStatus === latest version AND it is a revocation entry (isRevocation=== true) => revoked = true
const revoked = versionStatus === siloVersionStatuses.revoked;

const latestAccessionVersion = getLatestAccessionVersion(sequenceEntryHistory);

const isNotLatestVersion = versionStatus !== siloVersionStatuses.latestVersion;
---

<div class='py-3'>
    {
        isNotLatestVersion && (
            <div class='bg-yellow-100 border-l-4 border-yellow-500 text-yellow-700 p-3' role='alert'>
                <p class='font-bold'>This is not the latest version of this sequence entry.</p>
                {latestAccessionVersion !== undefined && (
                    <p>
                        Go to the latest version:
                        <a
                            href={routes.sequencesDetailsPage(organism, latestAccessionVersion)}
                            class='font-bold underline mx-3'
                        >
                            {getAccessionVersionString(latestAccessionVersion)}
                        </a>
                    </p>
                )}
            </div>
        )
    }
    {
        revoked && (
            <>
                <div class='bg-red-100 border-l-4 border-red-500 text-red-700 p-3 ' role='alert'>
                    <p class='font-bold'>This sequence entry has been revoked!</p>
                </div>
                <div class='fixed top-0 left-0 w-full h-full flex items-center justify-center pointer-events-none'>
                    <div class='text-red-600 rotate-45 text-8xl font-bold uppercase opacity-20'>REVOKED</div>
                </div>
            </>
        )
    }
</div>
