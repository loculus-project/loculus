---
import { seqSetsAreEnabled } from '../../config';
import { SeqSetCitationClient } from '../../services/seqSetCitationClient.ts';

if (!seqSetsAreEnabled()) {
    return Astro.rewrite('/404');
}

const { seqSetId = '' } = Astro.params;
const seqSetClient = SeqSetCitationClient.create();

const seqSetResponse = await seqSetClient.call('getSeqSet', {
    params: { seqSetId, version: '1' },
});

const latestVersion =
    seqSetResponse.isOk() && seqSetResponse.value.length > 0
        ? Math.max(...seqSetResponse.value.map((s) => s.seqSetVersion))
        : 1;

return Astro.redirect(`/seqsets/${seqSetId}.${latestVersion}`);
---
