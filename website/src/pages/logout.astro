---
import BaseLayout from '../layouts/BaseLayout.astro';
import { getInstanceLogger } from '../logger';
import { getKeycloakClient, TOKEN_COOKIE } from '../middleware';

async function logout() {
    const token = Astro.locals.session.token;

    if (token === undefined) {
        return;
    }

    await (await getKeycloakClient()).revoke(token.refresh_token!).catch(async (err) => {
        getInstanceLogger('logout page').error(`Failed to revoke token. Error ${err}`);
    });

    Astro.cookies.delete(TOKEN_COOKIE);
}

await logout();
---

<BaseLayout title='Logout'>
    <div>You have been logged out</div>
</BaseLayout>
