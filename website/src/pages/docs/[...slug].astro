---
import { getCollection, render } from 'astro:content';

import '../../styles/mdcontainer.scss';
import DocsMenu from '../../components/Navigation/DocsMenu';
import { getWebsiteConfig } from '../../config';
import BaseLayout from '../../layouts/BaseLayout.astro';
import MdiGithub from '~icons/mdi/github';

export async function getStaticPaths() {
    const docs = await getCollection('docs');
    return docs.map((entry) => ({
        params: { slug: entry.id },
        props: { entry },
    }));
}

const { entry } = Astro.props;
const { Content } = await render(entry);

const docs = await getCollection('docs');
const docsPages = docs.map((doc) => ({
    url: `/docs/${doc.id}`,
    file: `src/content/docs/${doc.id}.mdx`,
    frontmatter: doc.data,
}));

const currentPageUrl = Astro.url.pathname;
const { gitHubEditLink } = getWebsiteConfig();
const fileLocation = `src/content/docs/${entry.id}.mdx`;
const editUrl = `${gitHubEditLink}${fileLocation}`;
---

<BaseLayout title={entry.data.title} activeTopNavigationItem='/docs/'>
    <div class='md:flex md:justify-between max-w-5xl mx-auto items-start gap-10'>
        <DocsMenu docsPages={docsPages} currentPageUrl={currentPageUrl} title='Documentation' client:load />
        <div class='mdContainer mdContainerItself text-gray-700 leading-relaxed'>
            <h1>{entry.data.title}</h1>
            <Content />
            {
                gitHubEditLink !== undefined && (
                    <div class='text-right text-sm text-gray-500'>
                        <a
                            href={editUrl}
                            target='_blank'
                            rel='noopener noreferrer'
                            class='!text-gray-500 hover:!text-gray-800 !no-underline'
                        >
                            <MdiGithub className='inline-block w-4 h-4 mr-1' />
                            Edit this page
                        </a>
                    </div>
                )
            }
        </div>
    </div>
</BaseLayout>
