---
import NeedToLogin from '../../../components/common/NeedToLogin.astro';
import { RevisionForm } from '../../../components/Submission/RevisionForm';
import { getRuntimeConfig } from '../../../config';
import BaseLayout from '../../../layouts/BaseLayout.astro';
import { GroupManagementClient } from '../../../services/groupManagementClient';
import { getAccessToken } from '../../../utils/getAccessToken';

const organism = Astro.params.organism!;
const accessToken = getAccessToken(Astro.locals.session)!;

const groupsResult = await GroupManagementClient.create().getGroupsOfUser(accessToken);

const clientConfig = getRuntimeConfig().public;
---

<BaseLayout title='Submit'>
    <h1 class='title'>Revise sequences</h1>
    {
        groupsResult.isOk() && accessToken ? (
            <RevisionForm
                accessToken={accessToken}
                organism={organism}
                clientConfig={clientConfig}
                groupsOfUser={groupsResult.value}
                client:load
            />
        ) : (
            !accessToken ? (
               <NeedToLogin />
            ) :
            <p class='text-red-500'>Failed to load groups</p>
        )
    }
</BaseLayout>
