---
import { BackButton } from '../../../../../components/Navigation/BackButton';
import { ReviewPage } from '../../../../../components/Review/ReviewPage';
import { getRuntimeConfig } from '../../../../../config';
import BaseLayout from '../../../../../layouts/BaseLayout.astro';
import { BackendClient } from '../../../../../services/backendClient';
import { getAccessToken } from '../../../../../utils/getAccessToken';

const version = Astro.params.version!;
const accession = Astro.params.accession!;
const organism = Astro.params.organism!;
const accessToken = getAccessToken(Astro.locals.session)!;

const clientConfig = getRuntimeConfig().public;

const reviewData = await BackendClient.create().astroFileTypeHelpers.getDataToReview(
    organism,
    accessToken,
    accession,
    version,
);
---

<BaseLayout title={`Review ${accession}.${version}`}>
    <div class='flex items-center mb-4'>
        <BackButton marginRight={2} client:load />
        <h1 class='title'>
            Review for Id: {accession}.{version}
        </h1>
    </div>
    {
        reviewData.match(
            (reviewData) => (
                <ReviewPage
                    organism={organism}
                    accessToken={accessToken}
                    reviewData={reviewData}
                    clientConfig={clientConfig}
                    client:load
                />
            ),
            (error) => (
                <>
                    <div class='flex items-center'>
                        <h1 class='subtitle'>
                            Error while fetching review data for accession version: {accession}.{version}
                        </h1>
                    </div>
                    <div>{JSON.stringify(error)}</div>
                </>
            ),
        )
    }
</BaseLayout>
