---
import { ErrorFeedback } from '../../../../components/ErrorFeedback';
import { BackButton } from '../../../../components/Navigation/BackButton';
import UserSequences from '../../../../components/UserSequenceList/UserSequences.astro';
import BaseLayout from '../../../../layouts/BaseLayout.astro';
import { BackendClient } from '../../../../services/backendClient';

// eslint-disable-next-line
const username = Astro.params.username!;
const organism = Astro.params.organism!;
const token = Astro.locals.session?.token;

if (token === undefined || token.access_token === undefined) {
    console.log('No token found, redirecting to login');
    return Astro.redirect('/');
}

const userSequenceEntriesResponse = await BackendClient.create().astroFileTypeHelpers.getSequenceEntriesOfUser(
    organism,
    username,
    token.access_token,
);

---

<BaseLayout title='Sequences'>
    <>
        <div class='flex items-center'>
            <BackButton marginRight={2} client:load />
            <h1 class='subtitle'>{`Submitted sequence entries of user ${username}`}</h1>
        </div>
        {
            userSequenceEntriesResponse.match(
                (sequenceEntries) => <UserSequences sequenceEntries={sequenceEntries} username={username} />,
                (error) => (
                    <ErrorFeedback
                        message={'Error while fetching user sequences: ' + JSON.stringify(error)}
                        client:only='react'
                    />
                ),
            )
        }
    </>
</BaseLayout>
