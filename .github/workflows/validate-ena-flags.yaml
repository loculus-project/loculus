name: Validate submitToEnaProduction is not true in values.yaml
on:
    pull_request:
    push:
        branches:
        - main
concurrency:
  group: ci-${{ github.ref == 'refs/heads/main' && github.run_id || github.ref }}-validate-ena-flags
  cancel-in-progress: true
jobs:
  validate-ena-flags:
    name: Validate submitToEnaProduction is not true in values.yaml # Don't change: Referenced by .github/workflows/update-argocd-metadata.yml
    permissions:
      packages: read
      contents: read
      checks: read
    runs-on: ubuntu-latest
    timeout-minutes: 45
    env:
      sha: ${{ github.event.pull_request.head.sha || github.sha }}
      wait_timeout: ${{ github.ref == 'refs/heads/main' && 900 || 240 }}
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      - name: Validate submitToEnaProduction is not true in values.yaml
        run: |
          python -c "
          import yaml
          with open('kubernetes/loculus/values.yaml', 'r') as file:
            values = yaml.safe_load(file)
          submit_to_ena_prod = values.get('submitToEnaProduction', False)
          if submit_to_ena_prod:
            print('Error: The flag submitToEnaProduction is set to true - this will submit data to ENA production. Please set it to false in values.yaml')
            exit(1)
          "